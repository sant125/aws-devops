## kube-prometheus-stack — valores customizados para o gin-tattoo
## Helm chart: prometheus-community/kube-prometheus-stack

# ── Prometheus ────────────────────────────────────────────────────────────────
prometheus:
  prometheusSpec:
    retention: 15d
    retentionSize: "8GB"
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: gp2
          resources:
            requests:
              storage: 10Gi

    # Coleta ServiceMonitors de todos os namespaces
    serviceMonitorSelectorNilUsesHelmValues: false
    serviceMonitorSelector: {}
    serviceMonitorNamespaceSelector: {}

    # Coleta PodMonitors de todos os namespaces (CloudNativePG usa PodMonitor)
    podMonitorSelectorNilUsesHelmValues: false
    podMonitorSelector: {}
    podMonitorNamespaceSelector: {}

    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 2Gi

# ── Grafana ───────────────────────────────────────────────────────────────────
grafana:
  enabled: true
  adminPassword: "${GRAFANA_ADMIN_PASSWORD}"  # injetar via SealedSecret

  persistence:
    enabled: true
    storageClassName: gp2
    size: 5Gi

  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Sidecar carrega dashboards de ConfigMaps com label grafana_dashboard="1"
  sidecar:
    dashboards:
      enabled: true
      searchNamespace: ALL
      label: grafana_dashboard
      labelValue: "1"
    datasources:
      enabled: true

  # Datasources provisionados automaticamente
  additionalDataSources:
    - name: Loki
      type: loki
      url: http://loki.observability.svc:3100
      access: proxy

# ── AlertManager ─────────────────────────────────────────────────────────────
alertmanager:
  alertmanagerSpec:
    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: gp2
          resources:
            requests:
              storage: 2Gi

# ── Exporters ─────────────────────────────────────────────────────────────────
nodeExporter:
  enabled: true

kubeStateMetrics:
  enabled: true

# ── Desabilitados (não usamos etcd/scheduler gerenciados pelo EKS) ────────────
kubeEtcd:
  enabled: false

kubeControllerManager:
  enabled: false

kubeScheduler:
  enabled: false
